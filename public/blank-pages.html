
<!doctype html>
<html lang="en">
  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Blank Pages  &mdash; Atrana</title>

	<!-- Bootstrap CSS-->
	<link rel="stylesheet" href="assets/modules/bootstrap-5.1.3/css/bootstrap.css">
	<!-- Style CSS -->
	<link rel="stylesheet" href="assets/css/style.css">
	<!-- FontAwesome CSS-->
	<link rel="stylesheet" href="assets/modules/fontawesome6.1.1/css/all.css">
	<!-- Boxicons CSS-->
	<link rel="stylesheet" href="assets/modules/boxicons/css/boxicons.min.css">
</head>
<body>
  
  <!--Topbar -->
  <div class="topbar transition">
	<div class="bars">
		<button type="button" class="btn transition" id="sidebar-toggle">
			<i class="fa fa-bars"></i>
		</button>
	</div>
		<div class="menu">
			<ul>
				<li class="nav-item dropdown dropdown-list-toggle">
					<a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					   <i class="fa fa-bell size-icon-1"></i><span class="badge bg-danger notif">4</span>
					</a> 				 
					<div class="dropdown-menu dropdown-list">
						<!-- <div class="dropdown-header">Notifications</div> -->
						<div class="dropdown-list-content dropdown-list-icons">
							<div class="custome-list-notif"> 
							<a href="#" class="dropdown-item dropdown-item-unread">
								<div class="dropdown-item-icon bg-primary text-white">
								  <i class="fas fa-code"></i>
								</div>
								<!-- <div class="dropdown-item-desc">
									The Atrana template has the latest update!
								  <div class="time text-primary">3 Min Ago</div>
								</div> -->
							  </a>

							  <a href="#" class="dropdown-item">
								<div class="dropdown-item-icon bg-info text-white">
								  <i class="far fa-user"></i>
								</div>
								<!-- <div class="dropdown-item-desc">
								   Sri asks you for friendship!
								  <div class="time">12 Hours Ago</div>
								</div> -->
							  </a>

							  <a href="#" class="dropdown-item">
								<div class="dropdown-item-icon bg-danger text-white">
								  <i class="fas fa-check"></i>
								</div>
								<!-- <div class="dropdown-item-desc">
									Storage has been cleared, now you can get back to work!
								  <div class="time">20 Hours Ago</div>
								</div> -->
							  </a>

						  
							  <a href="#" class="dropdown-item">
								<div class="dropdown-item-icon bg-info text-white">
								  <i class="fas fa-bell"></i>
								</div>
								<!-- <div class="dropdown-item-desc">
								    Welcome to Atrana Template, I hope you enjoy using this template!
								  <div class="time">Yesterday</div>
								</div> -->
							  </a>
 
							</div>
						</div>

						<!-- <div class="dropdown-footer text-center">
						  <a href="#">View All</a>
						</div> -->

					  
				  </li>
<!-- 			 
				  <li class="nav-item dropdown">
					<a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					  <img src="assets/images/avatar/avatar-1.png" alt="">
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
						<a class="dropdown-item" href="my-profile.html"><i class="fa fa-user size-icon-1"></i> <span>My Profile</span></a>
						<a class="dropdown-item" href="settings.html"><i class="fa fa-cog size-icon-1"></i> <span>Settings</span></a>
						<hr class="dropdown-divider">
						<a class="dropdown-item" href="#"><i class="fa fa-sign-out-alt  size-icon-1"></i> <span>My Profile</span></a>
					</ul>
				  </li> -->
			</ul>
		</div>
	</div>


	<!--Sidebar-->
	<!-- <div class="sidebar transition overlay-scrollbars animate__animated  animate__slideInLeft">
        <div class="sidebar-content"> 
        	<div id="sidebar"> -->
			
			<!-- Logo -->
			<!-- <div class="logo">
					<h2 class="mb-0"><img src="assets/images/logo.png"> Atrana</h2>
			</div> -->

            <!-- <ul class="side-menu">
                <li>
					<a href="index.html" class="active">
						<i class='bx bxs-dashboard icon' ></i> Dashboard
					</a>
				</li> -->

				<!-- Divider-->
                <!-- <li class="divider" data-text="STARTER">STARTER</li>

                <li>
                    <a href="#">
						<i class='bx bx-columns icon' ></i> 
						Layout 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="layout-default.html">Default Layout</a></li>
                        <li><a href="layout-top-navigation.html">Top Navigation</a></li>
                    </ul>
                </li> -->
<!-- 
                <li>
					<a href="blank-pages.html">
						<i class='bx bxs-meh-blank icon'></i> 
						Blank Page
					</a>
				</li> -->

                <!-- <li>
                    <a href="#">
						<i class='fa fa-th icon' ></i> 
						Bootstrap 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a> -->
                    <!-- <ul class="side-dropdown">
						<li><a href="bootstrap-alert.html">Alert</a></li>
						<li><a href="bootstrap-badge.html">Badge</a></li>
						<li><a href="bootstrap-breadcrumb.html">Breadcrumb</a></li>
						<li><a href="bootstrap-buttons.html">Buttons</a></li>
						<li><a href="bootstrap-card.html">Card</a></li>
						<li><a href="bootstrap-carousel.html">Carousel</a></li>
						<li><a href="bootstrap-dropdown.html">Dropdown</a></li>
						<li><a href="bootstrap-list-group.html">List Group</a></li>
						<li><a href="bootstrap-modal.html">Modal</a></li>
						<li><a href="bootstrap-nav.html">Navs</a></li>
						<li><a href="bootstrap-pagination.html">Pagination</a></li>
						<li><a href="bootstrap-progress.html">Progress</a></li>
						<li><a href="bootstrap-spinner.html">Spinner</a></li>
                    </ul>
                </li> -->

				<!-- Divider-->
                <!-- <li class="divider" data-text="Atrana">Atrana</li>

				<li>
                    <a href="#">
						<i class='bx bx-columns icon' ></i> 
						Components 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="component-avatar.html">Avatar</a></li>
						<li><a href="component-toastify.html">Toastify</a></li>
                        <li><a href="component-sweet-alert.html">Sweet Alert</a></li>
                        <li><a href="component-hero.html">Hero</a></li>
                    </ul>
                </li> -->

                <!-- <li>
                    <a href="#">
						<i class='bx bxs-notepad icon' ></i> 
						Forms 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="forms-editor.html">Editor</a></li>
                        <li><a href="forms-validation.html">Validation</a></li>
                        <li><a href="forms-checkbox.html">Checkbox</a></li>
                        <li><a href="forms-radio.html">Radio</a></li>
                    </ul>
                </li> -->

				<!-- <li>
                    <a href="#">
						<i class='bx bxs-widget icon' ></i> 
						Widgets 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="widgets-chatboxs.html">ChatBox</a></li>
                        <li><a href="widgets-email.html">Emails</a></li>
                        <li><a href="widgets-pricing.html">Pricing</a></li>
                    </ul>
                </li> -->

				<!-- <li>
                    <a href="#">
						<i class='bx bxs-bar-chart-alt-2 icon' ></i> 
						Charts 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="chart-chartjs.html">ChartJS</a></li>
                        <li><a href="chart-apexcharts.html">Apexcharts</a></li>
                    </ul>
                </li> -->

				<!-- <li>
                    <a href="#">
						<i class='bx bxs-cloud-rain icon' ></i> 
						Icons 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="icons-fontawesome.html">Fontawesome</a></li>
                        <li><a href="icons-boostrap.html">Bootstrap Icons</a></li>
                    </ul>
                </li> -->

				<!-- Divider-->
				<!-- <li class="divider" data-text="Pages">Pages</li>

				<li>
                    <a href="#">
						<i class='bx bxs-user icon' ></i> 
						Auth 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="auth-login.html">Login</a></li>
                        <li><a href="auth-register.html">Register</a></li>
                        <li><a href="auth-forgot-password.html">Forgot Password</a></li>
                        <li><a href="auth-reset-password.html">Reset Password</a></li>
                    </ul>
                </li> -->

				<!-- <li>
                    <a href="#">
						<i class='bx bxs-error icon' ></i> 
						Errors 
						<i class='bx bx-chevron-right icon-right' ></i>
					</a>
                    <ul class="side-dropdown">
                        <li><a href="errors-403.html">403</a></li>
                        <li><a href="errors-404.html">404</a></li>
                        <li><a href="errors-500.html">500</a></li>
                        <li><a href="errors-503.html">503</a></li>
                    </ul>
                </li> -->


				<li>
					<a href="credits.html"><i class='fa fa-pencil-ruler icon' ></i> 
						Credits
					</a>
				</li>

            </ul>

            <div class="ads">
				<div class="wrapper">
					<div class="help-icon"><i class="fa fa-circle-question fa-3x"></i></div>
					<p>Need Help with <strong>Atrana</strong>?</p>
                    <a href="docs/" class="btn-upgrade">Documentation</a>
                 </div>
            </div>
        </div>

       </div> 
	 </div>
	</div><!-- End Sidebar-->


	<div class="sidebar-overlay"></div>


	<!--Content Start-->
	<div class="content-start transition  "> 
		<div class="container-fluid dashboard">
			<div class="content-header">
				<h1>Blank Page</h1>
			</div>
            
             
		 
            	
        </div><!-- End Container-->
    </div><!-- End Content-->

	<!-- Footer -->				
	<footer>
		<div class="footer">
			<div class="float-start">
				<p>2022 &copy; Atrana</p>
			</div>
				<div class="float-end">
					<p>Crafted with 
						<span class="text-danger">
							<i class="fa fa-heart"></i> by 
							<a href="https://www.facebook.com/andreew.co.id/" class="author-footer">Andre Tri Ramadana</a>
						</span> 
					</p>
			</div>
		</div>
	</footer>


	<!-- Preloader -->
	<div class="loader">
		<div class="spinner-border text-light" role="status">
			<span class="sr-only">Loading...</span>
		</div>
	</div>
	
	<!-- Loader -->
	<div class="loader-overlay"></div>

	<!-- General JS Scripts -->
	<script src="assets/js/atrana.js"></script>

	<!-- JS Libraies -->
	<script src="assets/modules/jquery/jquery.min.js"></script>
	<script src="assets/modules/bootstrap-5.1.3/js/bootstrap.bundle.min.js"></script>
	<script src="assets/modules/popper/popper.min.js"></script>
	
    <!-- Template JS File -->
	<script src="assets/js/script.js"></script>
	<script src="assets/js/custom.js"></script>

	<script>
		// Load user profile on page load
window.onload = function () {
    const profile = JSON.parse(localStorage.getItem("userProfile"));
    if (profile) {
        document.getElementById("username").innerText = profile.firstName || "User";
        document.getElementById("firstName").value = profile.firstName || "";
        document.getElementById("lastName").value = profile.lastName || "";
        document.getElementById("email").value = profile.email || "";
        document.getElementById("organization").value = profile.organization || "";

        if (profile.avatar) {
            document.getElementById("uploadedAvatar").src = profile.avatar;
            document.getElementById("navbarAvatar").src = profile.avatar; // Update the navbar avatar
        }
    }
};

// Handle image upload
document.getElementById("upload").addEventListener("change", function (event) {
    const file = event.target.files[0];
    if (file) {
        if (file.size > 800 * 1024) {
            alert("File size exceeds 800KB. Please upload a smaller file.");
            return;
        }
        const validTypes = ["image/jpeg", "image/png", "image/gif"];
        if (!validTypes.includes(file.type)) {
            alert("Invalid file type. Please upload a JPG, PNG, or GIF.");
            return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
            const avatarSrc = e.target.result;
            document.getElementById("uploadedAvatar").src = avatarSrc;
            document.getElementById("navbarAvatar").src = avatarSrc; // Update the navbar avatar dynamically

            // Save avatar to local storage
            saveProfileData({ avatar: avatarSrc });
        };
        reader.readAsDataURL(file);
    }
});

// Save profile data to local storage
document.getElementById("saveProfile").addEventListener("click", function () {
    const profile = {
        firstName: document.getElementById("firstName").value,
        lastName: document.getElementById("lastName").value,
        email: document.getElementById("email").value,
        organization: document.getElementById("organization").value,
        avatar: document.getElementById("uploadedAvatar").src,
    };

    localStorage.setItem("userProfile", JSON.stringify(profile));
    alert("Profile saved successfully!");
});

// Utility to save profile data partially
function saveProfileData(newData) {
    const profile = JSON.parse(localStorage.getItem("userProfile")) || {};
    const updatedProfile = { ...profile, ...newData };
    localStorage.setItem("userProfile", JSON.stringify(updatedProfile));

    // Update navbar avatar if the avatar was changed
    if (newData.avatar) {
        document.getElementById("navbarAvatar").src = newData.avatar;
    }
}

	</script>

<script>
	async function fetchUserData() {
		const token = localStorage.getItem('token');
		if (!token) {
			alert("User not authenticated, please login again.");
			window.location.href = '/login.html';
			return;
		}
		const response = await fetch('/api/users/me', {
			headers: { 'Authorization': `Bearer ${token}` },
		});
		if (response.ok) {
			const user = await response.json();
			document.getElementById('userName').textContent = user.name;
			document.getElementById('userEmail').textContent = user.email;
			document.getElementById('balance').textContent = user.balance.toFixed(2);
			document.getElementById('profits').textContent = user.profits.toFixed(2);
			if (user.profits > previousProfit) {
				alert(`Your profits have increased! New profit: $${user.profits.toFixed(2)}`);
			}
			previousProfit = user.profits;
		} else if (response.status === 403) {
			alert("Forbidden: Invalid token or session expired.");
			localStorage.removeItem('token');
			window.location.href = '/login.html';
		} else {
			alert('Failed to fetch user data');
		}
	}
	
	const socket = new WebSocket('ws://localhost:5000');
	socket.onopen = function () {
		console.log('Connected to WebSocket server');
	};
	socket.onmessage = function (event) {
		const data = JSON.parse(event.data);
		const newProfit = data.profits;
		document.getElementById('profits').textContent = newProfit.toFixed(2);
		if (newProfit > previousProfit) {
			alert(`Your profits have increased! New profit: $${newProfit.toFixed(2)}`);
		}
		previousProfit = newProfit;
	};
	socket.onclose = function () {
		console.log('Disconnected from WebSocket server');
	};
	
	setInterval(fetchUserData, 30000);
	fetchUserData();

	async function loadDepositHistory() {
		const token = localStorage.getItem('token');
		const response = await fetch('/api/transactions/deposit', {
			headers: { Authorization: `Bearer ${token}` },
		});
		if (response.ok) {
			const deposits = await response.json();
			const depositHistory = document.getElementById('depositHistory');
			depositHistory.innerHTML = '';
			deposits.forEach(deposit => {
				const tr = document.createElement('tr');
				tr.innerHTML = `
					<td>${deposit.amount.toFixed(2)}</td>
					<td>${deposit.status}</td>
					<td>${deposit.approvedAt || 'Pending'}</td>
					<td><a href="${deposit.proof}" target="_blank">View Proof</a></td>
				`;
				depositHistory.appendChild(tr);
			});
		} else {
			alert('Failed to load deposit history');
		}
	}
	
	async function loadTransactionHistory() {
		const token = localStorage.getItem('token');
		const response = await fetch(`/api/transactions/${localStorage.getItem('userId')}`, {
			headers: { Authorization: `Bearer ${token}` },
		});
		if (response.ok) {
			const transactions = await response.json();
			const transactionHistory = document.getElementById('transactionHistory');
			transactionHistory.innerHTML = '';
			transactions.forEach(transaction => {
				const tr = document.createElement('tr');
				tr.innerHTML = `
					<td>${transaction.amount.toFixed(2)}</td>
					<td>${transaction.type}</td>
					<td>${new Date(transaction.createdAt).toLocaleString()}</td>
					<td>${transaction.status}</td>
				`;
				transactionHistory.appendChild(tr);
			});
		} else {
			alert('Failed to load transaction history');
		}
	}
	
	document.getElementById('depositForm').addEventListener('submit', async (e) => {
		e.preventDefault();
		const amount = document.getElementById('amount').value;
		const plan = document.getElementById('plan').value;
		const walletAddress = document.getElementById('walletAddress').value;
		const proof = document.getElementById('proof').files[0];
		const formData = new FormData();
		formData.append('amount', amount);
		formData.append('plan', plan);
		formData.append('walletAddress', walletAddress);
		formData.append('proofOfPayment', proof);
		const response = await fetch('/api/transactions/deposit', {
			method: 'POST',
			headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },
			body: formData,
		});
		if (response.ok) {
			alert('Deposit submitted successfully');
			loadDepositHistory();
		} else {
			alert('Failed to submit deposit');
		}
	});
	
	document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
		e.preventDefault();
		const amount = document.getElementById('withdrawAmount').value;
		const address = document.getElementById('withdrawAddress').value;
		const response = await fetch('/api/transactions/withdraw', {
			method: 'POST',
			headers: {
				Authorization: `Bearer ${localStorage.getItem('token')}`,
				'Content-Type': 'application/json',
			},
			body: JSON.stringify({ amount, address }),
		});
		if (response.ok) {
			alert('Withdrawal request submitted successfully');
		} else {
			alert('Failed to submit withdrawal request');
		}
	});
	
	function copyWalletAddress() {
		const walletAddress = document.getElementById('walletAddress').value;
		navigator.clipboard.writeText(walletAddress).then(() => {
			alert('Wallet address copied');
		});
	}
	
	fetchUserData();

	


	

	// Function to load withdrawal history
async function loadWithdrawalHistory() {
const token = localStorage.getItem('token');

const response = await fetch('http://localhost:5000/api/transactions/withdrawal-history', {
	headers: {
		'Authorization': `Bearer ${token}`,
	},
});

if (response.ok) {
	const withdrawals = await response.json();
	const withdrawalHistory = document.getElementById('withdrawalHistory');
	withdrawalHistory.innerHTML = '';

	withdrawals.forEach(withdrawal => {
		const tr = document.createElement('tr');
		tr.innerHTML = `
			<td>${withdrawal.amount.toFixed(2)}</td>
			<td>${withdrawal.status}</td>
			<td>${new Date(withdrawal.createdAt).toLocaleString()}</td>
		`;
		withdrawalHistory.appendChild(tr);
	});
} else if (response.status === 404) {
	document.getElementById('withdrawalHistory').innerHTML = `<tr><td colspan="3" class="text-center">No withdrawal history found.</td></tr>`;
} else {
	alert('Failed to fetch withdrawal history');
}
}

// Add event listener to load withdrawal history when the tab is shown
document.getElementById('withdraw-tab').addEventListener('click', loadWithdrawalHistory);

// Load withdrawal history on page load
loadWithdrawalHistory();

</script>

 </body>
</html>
